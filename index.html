<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Filter Google Sheet Data</title>
  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; }
    th { background: #f3f3f3; }
    .filter { margin: 8px 0; }
  </style>
</head>
<body>
  <h2>Filter Google Sheet Data</h2>
  <div class="filter">
    <input type="text" id="Ngay" placeholder="Filter by Ngày">
    <input type="text" id="Thang" placeholder="Filter by Tháng">
    <input type="text" id="Nam" placeholder="Filter by Năm">
    <button onclick="applyFilter()">Filter</button>
    <button onclick="resetFilter()">Reset</button>
  </div>
  <div id="table-container">Loading...</div>

  <script>
    // Link CSV Google Sheet của bạn - sheet "Data"
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1YmAdEK-QP1RjSa7ohyURPaUSh7HfgrJE/tq?tqx=out:csv&sheet=Data";
    let rawData = [];
    let headers = [];

    // Hàm fetch và parse CSV
    async function loadSheet() {
      const res = await fetch(SHEET_CSV_URL);
      const csvText = await res.text();
      const rows = csvText.trim().split('\n').map(row => row.split(','));
      headers = rows[0];
      rawData = rows.slice(1).map(r => r.map(cell => cell.trim()));
      renderTable(rawData);
    }

    function renderTable(data) {
      if (data.length === 0) {
        document.getElementById("table-container").innerHTML = "<i>No data</i>";
        return;
      }
      let html = "<table><thead><tr>";
      html += headers.map(h => `<th>${h}</th>`).join('');
      html += "</tr></thead><tbody>";
      html += data.map(row => "<tr>" + row.map(cell => `<td>${cell}</td>`).join('') + "</tr>").join('');
      html += "</tbody></table>";
      document.getElementById("table-container").innerHTML = html;
    }

    function applyFilter() {
      const ngay = document.getElementById("Ngay").value.trim().toLowerCase();
      const thang = document.getElementById("Thang").value.trim().toLowerCase();
      const nam = document.getElementById("Nam").value.trim().toLowerCase();

      // Xác định vị trí các cột "Ngày", "Tháng", "Năm"
      const idxNgay = headers.findIndex(h => h.trim().toLowerCase() === "ngày");
      const idxThang = headers.findIndex(h => h.trim().toLowerCase() === "tháng");
      const idxNam = headers.findIndex(h => h.trim().toLowerCase() === "năm");

      let filtered = rawData.filter(row => {
        let matchNgay = ngay === "" || (idxNgay >= 0 && row[idxNgay].toLowerCase().includes(ngay));
        let matchThang = thang === "" || (idxThang >= 0 && row[idxThang].toLowerCase().includes(thang));
        let matchNam = nam === "" || (idxNam >= 0 && row[idxNam].toLowerCase().includes(nam));
        return matchNgay && matchThang && matchNam;
      });
      renderTable(filtered);
    }

    function resetFilter() {
      document.getElementById("Ngay").value = "";
      document.getElementById("Thang").value = "";
      document.getElementById("Nam").value = "";
      renderTable(rawData);
    }

    loadSheet();
  </script>
</body>
</html>
